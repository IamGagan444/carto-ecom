import{_ as L,u as I,a as v}from"./useForkRef-e7e06615.js";import{r as o,j as b,a as D}from"./index-7afc777e.js";import{o as T,d as P}from"./ownerWindow-fbe9f185.js";import{u as F}from"./useEnhancedEffect-b6d467e7.js";const U=["onChange","maxRows","minRows","style","value"];function w(r){return parseInt(r,10)||0}const V={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function M(r){return r==null||Object.keys(r).length===0||r.outerHeightStyle===0&&!r.overflow}const K=o.forwardRef(function(l,O){const{onChange:R,maxRows:x,minRows:h=1,style:S,value:y}=l,k=L(l,U),{current:A}=o.useRef(y!=null),p=o.useRef(null),N=I(O,p),H=o.useRef(null),u=o.useRef(0),[z,E]=o.useState({outerHeightStyle:0}),f=o.useCallback(()=>{const e=p.current,n=T(e).getComputedStyle(e);if(n.width==="0px")return{outerHeightStyle:0};const t=H.current;t.style.width=n.width,t.value=e.value||l.placeholder||"x",t.value.slice(-1)===`
`&&(t.value+=" ");const g=n.boxSizing,m=w(n.paddingBottom)+w(n.paddingTop),a=w(n.borderBottomWidth)+w(n.borderTopWidth),c=t.scrollHeight;t.value="x";const d=t.scrollHeight;let s=c;h&&(s=Math.max(Number(h)*d,s)),x&&(s=Math.min(Number(x)*d,s)),s=Math.max(s,d);const j=s+(g==="border-box"?m+a:0),B=Math.abs(s-c)<=1;return{outerHeightStyle:j,overflow:B}},[x,h,l.placeholder]),C=(e,i)=>{const{outerHeightStyle:n,overflow:t}=i;return u.current<20&&(n>0&&Math.abs((e.outerHeightStyle||0)-n)>1||e.overflow!==t)?(u.current+=1,{overflow:t,outerHeightStyle:n}):e},W=o.useCallback(()=>{const e=f();M(e)||E(i=>C(i,e))},[f]);F(()=>{const e=()=>{const c=f();M(c)||D.flushSync(()=>{E(d=>C(d,c))})},i=()=>{u.current=0,e()};let n;const t=P(i),g=p.current,m=T(g);m.addEventListener("resize",t);let a;return typeof ResizeObserver<"u"&&(a=new ResizeObserver(i),a.observe(g)),()=>{t.clear(),cancelAnimationFrame(n),m.removeEventListener("resize",t),a&&a.disconnect()}},[f]),F(()=>{W()}),o.useEffect(()=>{u.current=0},[y]);const _=e=>{u.current=0,A||W(),R&&R(e)};return b.jsxs(o.Fragment,{children:[b.jsx("textarea",v({value:y,onChange:_,ref:N,rows:h,style:v({height:z.outerHeightStyle,overflow:z.overflow?"hidden":void 0},S)},k)),b.jsx("textarea",{"aria-hidden":!0,className:l.className,readOnly:!0,ref:H,tabIndex:-1,style:v({},V.shadow,S,{paddingTop:0,paddingBottom:0})})]})});export{K as T};
